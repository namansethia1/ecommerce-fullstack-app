<div class="container mt-4">
  <h2>Shopping Cart</h2>
  
  <!-- Empty Cart Message -->
  <div *ngIf="cartItems.length === 0" class="text-center mt-5">
    <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
    <h4>Your cart is empty</h4>
    <p class="text-muted">Add some products to your cart to get started.</p>
    <button class="btn btn-primary" routerLink="/products">
      <i class="fas fa-shopping-bag me-2"></i>
      Continue Shopping
    </button>
  </div>

  <!-- Cart Items -->
  <div *ngIf="cartItems.length > 0">
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Cart Items ({{ totalQuantity }})</h5>
          </div>
          <div class="card-body">
            <div class="row align-items-center border-bottom py-3" *ngFor="let item of cartItems">
              <!-- Product Image -->
              <div class="col-md-2">
                <img [src]="item.product.imageUrl" 
                     [alt]="item.product.name" 
                     class="img-fluid rounded cart-item-image"
                     (error)="onImageError($event)">
              </div>
              
              <!-- Product Details -->
              <div class="col-md-4">
                <h6 class="mb-1">{{ item.product.name }}</h6>
                <p class="text-muted small mb-1">{{ item.product.description | slice:0:80 }}...</p>
                <small class="text-success">In Stock: {{ item.product.unitsInStock }}</small>
              </div>
              
              <!-- Quantity Controls -->
              <div class="col-md-3">
                <div class="d-flex align-items-center">
                  <button class="btn btn-outline-secondary btn-sm" 
                          (click)="decreaseQuantity(item.product.id!)"
                          [disabled]="item.quantity <= 1">
                    <i class="fas fa-minus"></i>
                  </button>
                  <span class="mx-3 fw-bold">{{ item.quantity }}</span>
                  <button class="btn btn-outline-secondary btn-sm" 
                          (click)="increaseQuantity(item.product.id!)"
                          [disabled]="item.quantity >= item.product.unitsInStock">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
              
              <!-- Price and Remove -->
              <div class="col-md-3">
                <div class="text-end">
                  <p class="h6 text-primary mb-1">${{ (item.product.unitPrice * item.quantity) | number:'1.2-2' }}</p>
                  <small class="text-muted">${{ item.product.unitPrice | number:'1.2-2' }} each</small>
                  <br>
                  <button class="btn btn-outline-danger btn-sm mt-2" 
                          (click)="removeFromCart(item.product.id!)">
                    <i class="fas fa-trash"></i> Remove
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Continue Shopping -->
        <div class="mt-3">
          <button class="btn btn-outline-primary" routerLink="/products">
            <i class="fas fa-arrow-left me-2"></i>
            Continue Shopping
          </button>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="col-md-4">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Order Summary</h5>
          </div>
          <div class="card-body">
            <div class="d-flex justify-content-between mb-2">
              <span>Subtotal ({{ totalQuantity }} items):</span>
              <span>${{ totalPrice | number:'1.2-2' }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Shipping:</span>
              <span>{{ totalPrice > 50 ? 'FREE' : '$5.99' }}</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Tax:</span>
              <span>${{ (totalPrice * 0.08) | number:'1.2-2' }}</span>
            </div>
            <hr>
            <div class="d-flex justify-content-between h5">
              <span>Total:</span>
              <span>${{ getFinalTotal() | number:'1.2-2' }}</span>
            </div>

            <div class="d-grid gap-2 mt-3">
              <button class="btn btn-success btn-lg" 
                      (click)="proceedToCheckout()"
                      [disabled]="!canProceedToCheckout()">
                <i class="fas fa-credit-card me-2"></i>
                Proceed to Checkout
              </button>
              <button class="btn btn-outline-danger" 
                      (click)="clearCart()">
                <i class="fas fa-trash me-2"></i>
                Clear Cart
              </button>
            </div>

            <!-- Free Shipping Notice -->
            <div class="alert alert-info mt-3" *ngIf="totalPrice < 50">
              <small>
                <i class="fas fa-info-circle me-1"></i>
                Add ${{ (50 - totalPrice) | number:'1.2-2' }} more for FREE shipping!
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
